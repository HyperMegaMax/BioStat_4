## Задание 1

Рассмотрите следующую статистическую гипотезу.

Проводят некоторое исследование пациентов с артериальной гипертензией. Предположим, что внедрение нового препарата в среднем лучше снижает их давление по сравнению со стандартной терапией.

Задайте seed для воспроизводимости результатов (функция set.seed()). Задайте размер выборки sample_size <- 30. Задайте значение среднего артериального давления до приема нового препарата и после.

```{r}
# Библиотеки
library(ggplot2)
library(tidyverse)
 library(car)
```

```{r}
# Установка seed
set.seed(123)

# Задаем размер выборки
sample_size <- 30

# Среднее АД до и после приема препарата
mean_pressure_before <- 140
mean_pressure_after <- 130
sd <- 15

# Симулируем значения АД до и после приема нового препарата
pressure_before <- rnorm(sample_size, mean = mean_pressure_before, sd = sd)
pressure_after <- rnorm(sample_size, mean = mean_pressure_after, sd = sd)

# Объединяем данные
pressure_combined <- data.frame(Pressure_Before = pressure_before,
                            Pressure_After = pressure_after)

head(pressure_combined)
```
Затем:

- Сформулируйте нулевую и альтернативную гипотезы.
- Определите уровень значимости.
- Выберите статистический тест для проверки гипотезы и аргументируйте свой выбор.
- Определите наблюдаемое значение статистики, а также критическое значение статистики.
- Оцените и прокомментируйте статистическую значимость.

Нулевая гипотеза (H0): Новый препарат не оказывает статистически значимого влияния на снижение артериального давления у пациентов с артериальной гипертензией по сравнению со стандартной терапией. 
Альтернативная гипотеза (H1): Новый препарат статистически значимо снижает артериальное давление у пациентов с артериальной гипертензией по сравнению со стандартной терапией. 

Уровень значимости установим равным 0,05:

$$
\alpha = 0.05
$$
Для выбора статистического теста изучим распределение данных:

```{r}
# QQ-график для данных до приема препарата
qqnorm(pressure_combined$Pressure_Before, main = "QQ-график для давления до приема препарата")
qqline(pressure_combined$Pressure_Before, col = "red")

# QQ-график для данных после приема препарата
qqnorm(pressure_combined$Pressure_After, main = "QQ-график для давления после приема препарата")
qqline(pressure_combined$Pressure_After, col = "red")
```
Графически распределение данных выглядит близким к нормальныму в обоих случаях

```{r}
# тест Шапиро-Уилка на нормальность распределения

shapiro.test(pressure_combined$Pressure_Before)
shapiro.test(pressure_combined$Pressure_After)
```
Тест уверенно показывает, что у нас нет оснований отвергать гипотезу о нормальности распределения данных.

Поэтому в данном случае можно применить парный t-test: данные количественные,  распределены нормально, 2 зависимые выборки.

```{r}
# Проводим парный t-test
t.test(pressure$Pressure_Before, pressure$Pressure_After, paired = TRUE)

# Рассчитываем критическое значение
# Для двустороннего теста с уровнем значимости 0.05 и степенями свободы 29
alpha <- 0.05
df <- 29
critical_value <- qt(1 - alpha/2, df)
critical_value

```
Мы видим, что в среднем артериальное давление снижается после приема препарата на 6.6 единиц, однако p-value значительно превышает заданный нами порог статистической значимости, доверительныйи интервал включает ноль и отрицательные значения, а t-статистика меньше критического значения.
Поэтому у нас нет оснований отвергнуть Н0 о том, что новый препарат не оказывает статистически значимого влияния на снижение артериального давления.




## Задание 2

Рассмотрите следующую статистическую гипотезу.

-   Существует некоторая связь между курением и развитием рака легких. Пусть у курящих людей вероятность заболеть раком легких составляет 0.8, а у некурящих — 0.2

-   Рассмотрите два случая: для выборки `sample_size1 <- 100` и выборки `sample_size2 <- 30`. Сгенерируйте данные по курению с помощью функции `rep()`, пусть отношение числа курящих к некурящим в каждой выборке составляет 1:1.

```{r}
set.seed(123) 

# Задаем размеры выборок
sample_size1 <- 100
sample_size2 <- 30

# Функция для генерации данных
generate_data <- function(sample_size) {
  # Сгенерировать данные о курении
  smoking_status <- rep(c(1, 0), times = sample_size / 2)
  
  # Сгенерировать данные о заболеваемости раком легких
  # Курящие с вероятностью 0.8, некурящие с вероятностью 0.2
  lung_cancer <- ifelse(smoking_status == 1,
                        rbinom(n = sample_size / 2, size = 1, prob = 0.8),
                        rbinom(n = sample_size / 2, size = 1, prob = 0.2))
  
  # Вернуть объединенные данные
  data <- data.frame(SmokingStatus = smoking_status, LungCancer = lung_cancer)
  return(data)
}

# Генерировать данные для обеих выборок
data_sample1 <- generate_data(sample_size1)
data_sample2 <- generate_data(sample_size2)

head(data_sample1)
head(data_sample2)

```

- Сформулируйте нулевую и альтернативную гипотезы.
- Определите уровень значимости.
- Выберите статистический тест для проверки гипотезы и аргументируйте свой выбор.
- Определите наблюдаемое значение статистики, а также критическое значение статистики.
- Оцените и прокомментируйте статистическую значимость.

Нулевая гипотеза (H0): Курение не влияет на риск развития рака легких. 
Альтернативная гипотеза (H1): Курение влияет на риск развития рака легких. 

Зададим уровень значимости 0.05
$$ \alpha = 0.05 $$
У нас есть категориальные переменные, представленные в виде таблицы сопряженности 2х2, наблюдения независимые между собой, поэтому для оценки статистики выбираем точный тест Фишера.

```{r}
# Создание таблиц сопряженности для каждой выборки
table1 <- table(data_sample1$SmokingStatus, data_sample1$LungCancer)
table2 <- table(data_sample2$SmokingStatus, data_sample2$LungCancer)

# Проведение точного теста Фишера для первой выборки
fisher_test_sample1 <- fisher.test(table1)

# Проведение точного теста Фишера для второй выборки
fisher_test_sample2 <- fisher.test(table2)

# Вывод результатов теста
fisher_test_sample1
fisher_test_sample2
```
Значения p-value в обеих группах значительно меньше заданного порога, есть достаточные основания отвергнуть нулевую гипотезу о том, что нет взаимосвязи между курением и развитием рака легких в этой выборке. Доверительный интервал положителен и также в обоих случаях показывает значительную ассоциацию между курением и развитием рака легких. 
Отношение шансов курящим заболеть раком легких по сравнению с некурящими выше в 56 и 11,7 раз для 1й и 2й выборки соответственно.



## Задание 3

Рассмотрите следующую статистическую гипотезу.

-   Применение нового метода лечения синдрома раздраженного кишечника значимо меняет уровень болевых симптомов по сравнению с группой, прошедшей лечение диетотерапией.

-   Исследователь избегает любых допущений, кроме того, что выборки независимы и имеют одинаковое распределение.


Создадим две выборки из равномерного распределения, представляющие уровень болевых симптомов для каждой группы.  Числа в выборках будем интерпретировать как количественную оценку уровня болевых симптомов, где большие значения указывают на более высокий уровень симптомов.
```{r}
set.seed(123) # Установка зерна генератора случайных чисел для воспроизводимости результатов

# Параметры выборок
n_treatment <- 30 # Количество наблюдений в группе с новым методом лечения
n_control <- 30 # Количество наблюдений в контрольной группе

# Генерация выборок
treatment_group <- runif(n_treatment, min=0, max=5)
control_group <- runif(n_control, min=0, max=5) 

# Вывод  данных
print("Группа с новым методом лечения:")
print(treatment_group)
print("Контрольная группа с диетотерапией:")
print(control_group)

```

- Сформулируйте нулевую и альтернативную гипотезы.
- Определите уровень значимости.
- Выберите статистический тест для проверки гипотезы и аргументируйте свой выбор.
- Определите наблюдаемое значение статистики, а также критическое значение статистики.
- Оцените и прокомментируйте статистическую значимость.

Нулевая гипотеза (H0): Новый метод лечения не имеет статистически значимого эффекта на уровень болевых симптомов у пациентов с СРК по сравнению с диетотерапией.
Альтернативная гипотеза (H1): Новый метод лечения имеет статистически значимое воздействие на уровень болевых симптомов у пациентов с СРК по сравнению с диетотерапией.

Зададим уровень значимости 0.05:
$$ \alpha = 0.05 $$

Оценим распределение данных

```{r}
# Для группы с новым методом лечения (treatment_group)
qqnorm(treatment_group, main = "Q-Q Plot для группы с новым методом лечения")
qqline(treatment_group, col = "red")

# Для контрольной группы (control_group)
qqnorm(control_group, main = "Q-Q Plot для контрольной группы с диетотерапией")
qqline(control_group, col = "blue")
```
Данные похожи на нормально распределенные, особенно в группе с новым методом лечения.
Проверим нормальность распределения статистически:

```{r}
# Тест Шапиро-Уилка
shapiro_test_treatment <- shapiro.test(treatment_group)
shapiro_test_control <- shapiro.test(control_group)

print("Тест Шапиро-Уилка для группы с новым методом лечения:")
print(shapiro_test_treatment)
print("Тест Шапиро-Уилка для контрольной группы:")
print(shapiro_test_control)
```
Группа с новым методом лечения: Поскольку p-значение больше 0.05 - мы не отвергаем нулевую гипотезу о нормальности распределения данных в этой группе. 
Контрольная группа: P-значение меньше 0.05 - мы отвергаем нулевую гипотезу о нормальности распределения данных в контрольной группе. 

Учитывая, что данные в контрольной группе не следуют нормальному распределению, для проверки гипотез мы используем непараметрический статистический тест Манна-Уитни:

```{r}
# Расчет среднего значения для группы с новым методом лечения
mean_treatment_group <- mean(treatment_group)

# Расчет среднего значения для контрольной группы
mean_control_group <- mean(control_group)

# Вывод средних значений
print(paste("Среднее значение для группы с новым методом лечения:", mean_treatment_group))
print(paste("Среднее значение для контрольной группы:", mean_control_group))


# Выполнение теста Манна-Уитни
mann_whitney_test <- wilcox.test(treatment_group, control_group, alternative = "two.sided")

# Вывод результатов теста
print(mann_whitney_test)

```
Мы видим значительное различие в средних значения оценки уровня боли между группами.
Однако P-значение (0.08234) выше обычно используемого порогового уровня значимости 0.05. Это означает, что на установленном уровне значимости у нас недостаточно доказательств для отклонения нулевой гипотезы о том, что распределение уровня болевых симптомов одинаково в обеих группах. 
